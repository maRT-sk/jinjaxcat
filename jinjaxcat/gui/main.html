<!DOCTYPE html>
<html lang="en">
<head>
	<title>JinjaXCat</title>
	<link rel="icon"
	      type="image/svg"
	      href="favicon.ico">
	<script type="text/javascript"
	        src="/eel.js"></script>
	<script type="text/javascript"
	        src="main.js"></script>
	<!--<script src="//unpkg.com/alpinejs" defer></script>-->
	<script src="alpinejs-3.12.2.min.js"
	        defer></script>
<!--	<script src="https://cdn.tailwindcss.com?plugins=forms,typography,aspect-ratio"></script>-->
	<link href="output-tailwind.css"
	      rel="stylesheet">
</head>
<body x-data="formLogic"
      class="mx-auto flex flex-col items-center justify-center p-2 caret-transparent max-w-[110rem] sm:p-6 md:p-8">
<header class="w-full">
	<h1 class="mb-4 text-4xl font-extrabold leading-none tracking-tight text-gray-900 md:text-5xl lg:text-6xl">
		JinjaXCat</h1>
	<p class="mt-2 text-lg text-gray-500">Generate any text based e-catalog with the power of
		<span class="whitespace-nowrap">Jinja templating!</span>
	</p>
</header>
<main class="mt-12 grid w-full grid-cols-1 gap-6 md:gap-12 lg:grid-cols-2">
	<div class="col-span-1">
		<div x-on:change="resetPresetSelection()"
		     class="grid gap-6">
			<section>
				<div>
					<label class="mb-2 block text-sm font-medium text-gray-900">
						Select input files in .csv, .xlsx, or .json format</label>
					<div class="flex">
						<button @click="chooseInputFiles(inputFiles)"
						        :disabled="isLoading"
						        class="w-full flex-none cursor-pointer whitespace-nowrap rounded-lg border border-gray-300 bg-gray-900 px-4 text-left text-sm font-semibold text-gray-50 transition py-2.5 hover:bg-gray-800 focus:border-blue-500 focus:ring-blue-500"
						>Choose Files
						</button>
					</div>
					<template x-for="(file, index) in inputFiles"
					          :key="index">
						<div class="relative mt-1.5">
							<input type="text"
							       :value="file"
							       class="w-full rounded-lg border border-gray-300 bg-gray-50 text-sm text-gray-900 p-2.5 focus:border-blue-500 focus:ring-blue-500">
							<button @click="removeFile(index); resetPresetSelection()"
							        class="absolute inset-y-0 right-0 flex cursor-pointer items-center fill-amber-400 px-3 pr-2 text-red-400 transition hover:text-red-500">
								<svg xmlns="http://www.w3.org/2000/svg"
								     fill="#f3f4f6"
								     viewBox="0 0 24 24"
								     stroke-width="1.5"
								     stroke="currentColor"
								     class="h-6 w-6">
									<path stroke-linecap="round"
									      stroke-linejoin="round"
									      d="M15 12H9m12 0a9 9 0 11-18 0 9 9 0 0118 0z"/>
								</svg>
							</button>
						</div>
					</template>
				</div>
			</section>
			<section>
				<div>
					<label for="template"
					       class="mb-2 block text-sm font-medium text-gray-900">Jinja2 template</label>
					<div class="flex">
						<button x-on:click="chooseTemplate()"
						        :disabled="isLoading"
						        class="flex cursor-pointer whitespace-nowrap rounded-l-lg border border-gray-300 bg-gray-900 px-4 text-left text-sm font-semibold text-gray-50 transition py-2.5 hover:bg-gray-800 focus:border-blue-500 focus:ring-blue-500"
						>Choose Template
						</button>
						<input x-ref="template"
						       :value="template"
						       type="text"
						       id="template"
						       required
						       class="grow rounded-r-lg border border-gray-300 bg-gray-50 text-sm text-gray-900 p-2.5 focus:border-blue-500 focus:ring-blue-500">
					</div>
				</div>
			</section>
			<section class="-mb-1.5">
				<h3 class="mb-2 block text-sm font-medium text-gray-900 5">Format output</h3>
				<label class="relative inline-flex cursor-pointer items-center">
					<input x-model="prettifyOutput"
					       x-ref="prettifyOutput"
					       x-on:change="updateLog(`Output beautification applied: ${prettifyOutput}`)"
					       type="checkbox"
					       checked
					       class="sr-only peer">
					<span class="w-11 h-6 bg-gray-200 peer-focus:outline-none peer-focus:ring-2 peer-focus:ring-blue-500 -blue-800 rounded-full peer peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-5 after:w-5 after:transition-all peer-checked:bg-gray-900 hover:peer-checked:bg-gray-800"></span>
					<span class="ml-3 whitespace-nowrap text-sm font-medium text-gray-900">Beautify the output for .xml and .csv files</span>
				</label>
			</section>
			<section class="-mb-1.5">
				<h3 class="mb-2 block text-sm font-medium text-gray-900">Validation and linting</h3>
				<select
						x-model="validationType"
						x-on:change="updateLog(`Validation type chosen: ${validationType}`)"
						class="col-span-2 block w-full cursor-pointer rounded-lg border border-gray-300 bg-gray-50 px-5 text-sm font-medium text-gray-900 transition py-2.5 focus:border-blue-500 focus:ring-blue-500">
					<option value="None">None</option>
					<template x-for="(validationType, index) in eel.validation_types()"
					          :key="index">
						<option :value="validationType.value"
						        x-text="validationType.text">
						</option>
					</template>
				</select>
				<div x-show="validationType === 'xml'"
				     x-cloak
				     class="mt-3 flex">
					<button x-on:click="chooseValidationFile()"
					        :disabled="isLoading"
					        class="flex cursor-pointer whitespace-nowrap rounded-l-lg border border-gray-300 bg-gray-900 px-4 text-left text-sm font-semibold text-gray-50 transition py-2.5 hover:bg-gray-800 focus:border-blue-500 focus:ring-blue-500"
					>Choose Validation File
					</button>
					<input x-ref="xmlValidationFile"
					       :value="xmlValidationFile"
					       type="text"
					       id="xmlValidationFile"
					       class="grow rounded-r-lg border border-gray-300 bg-gray-50 text-sm text-gray-900 p-2.5 focus:border-blue-500 focus:ring-blue-500">
				</div>
			</section>
		</div>
		<div class="mt-6">
			<h3 class="mb-2 block text-sm font-medium text-gray-900">Presets</h3>
			<div class="grid grid-cols-2 gap-3">
				<select x-init="refreshPresetNames()"
				        x-ref="presetSelect"
				        x-on:change="loadPreset($event.target.value)"
				        class="col-span-2 block w-full cursor-pointer rounded-lg border border-gray-300 bg-gray-50 px-5 text-sm font-medium text-gray-900 transition py-2.5 focus:border-blue-500 focus:ring-blue-500">
					<option selected
					        value="Select Preset">Select Preset
					</option>
					<template x-for="preset in allPresetNames">
						<option :value="preset"
						        x-text="preset">
						</option>
					</template>
				</select>
				<div
						@click="savePreset()"
						class="col-span-2 cursor-pointer rounded-lg border bg-gray-50 px-5 text-sm font-medium text-gray-900 transition py-2.5 hover:bg-gray-100 focus:outline-none focus:ring-2 focus:ring-gray-300 sm:col-span-1"
				>Save Preset
				</div>
				<div @click="eel.delete_preset(activePreset); refreshPresetNames()"
				     x-text="(activePreset ? 'Delete: ' + activePreset : 'Delete preset')"
				     class="col-span-2 cursor-pointer rounded-lg border bg-gray-50 px-5 text-sm font-medium text-gray-900 transition py-2.5 hover:bg-gray-100 focus:outline-none focus:ring-2 focus:ring-gray-300 sm:col-span-1"
				     :class="!activePreset && 'text-gray-300 hover:bg-gray-50 cursor-default focus:ring-0'"
				>Delete preset
				</div>
			</div>
		</div>
		<button @click="submitForm()"
		        :disabled="isLoading"
		        class="col-span-4 mt-12 w-full rounded-lg bg-gray-900 px-5 text-sm font-medium uppercase text-white transition py-2.5 hover:bg-gray-800 focus:outline-none focus:ring-2 focus:ring-gray-300"
		>Generate
		</button>
	</div>
	<aside x-init="window.x_data = $data"
	       class="col-span-1 flex flex-col">
		<h3 class="mb-2 block text-sm font-medium text-gray-900">Console log</h3>
		<div class="overflow-x-scroll whitespace-nowrap rounded-lg bg-gray-100 px-3 py-4 min-h-[10rem] h-[60vh]">
			<pre x-text="log"
			     class="mb-4 flex-grow font-mono text-gray-900"></pre>
		</div>
	</aside>
</main>
<div x-show="showModal"
     x-cloak
     x-transition:enter="ease-out duration-300"
     x-transition:enter-start="opacity-0 backdrop-blur-sm"
     x-transition:enter-end="opacity-100 backdrop-blur-xl"
     x-transition:leave="ease-out duration-300"
     x-transition:leave-start="opacity-100 "
     x-transition:leave-end="opacity-0"
     class="fixed inset-0 z-10 overflow-y-auto">
	<div class="flex min-h-screen items-center justify-center px-4 pt-4 pb-20 text-center sm:flex sm:p-0">
		<div class="fixed inset-0 bg-gray-600 bg-opacity-50 backdrop-blur-xl"></div>
		<!-- This element is to trick the browser into centering the modal contents. -->
		<span class="hidden sm:inline-block sm:h-screen sm:align-middle">&#8203;</span>
		<div x-show="showModal"
		     @click.away="showModal = false"
		     x-transition:enter="ease-out duration-300"
		     x-transition:enter-start="opacity-0 translate-y-4 sm:translate-y-0 sm:scale-95"
		     x-transition:enter-end="opacity-100 translate-y-0 sm:scale-100"
		     x-transition:leave="ease-in duration-200"
		     x-transition:leave-start="opacity-100 translate-y-0 sm:scale-100"
		     x-transition:leave-end="opacity-0 translate-y-4 sm:translate-y-0 sm:scale-95"
		     class="relative inline-block max-w-5xl transform overflow-auto rounded-lg bg-white px-4 pt-5 pb-4 text-left align-bottom shadow-xl transition-all sm:mx-4 sm:my-8 sm:p-6 sm:align-middle">
			<div class="mt-3 text-center sm:mt-5">
				<h3 class="mb-4 text-4xl font-extrabold leading-none tracking-tight text-gray-900 md:text-5xl lg:text-4xl">
					Alert</h3>
				<p x-text="modalMsg"
				   class="mt-4 break-words text-lg text-gray-500">
				</p>
			</div>
			<div class="mt-5 flex justify-center sm:mt-6">
				<button class="col-span-4 rounded-lg bg-gray-900 px-12 text-sm font-medium uppercase text-white transition py-2.5 hover:bg-gray-800 focus:outline-none focus:ring-2 focus:ring-gray-300"
				        @click="showModal=false"> OK
				</button>
			</div>
		</div>
	</div>
</div>
</body>
</html>